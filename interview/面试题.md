***先定一个短期目标***
* 运维高级工程师需要具备以下一些技能：
  * 系统管理：熟练掌握各种操作系统的安装、配置、维护和优化，如 Linux、Unix、Windows 等。
  * 网络管理：具备良好的网络基础知识，包括 TCP/IP 协议、路由、交换机、防火墙等。
  * 数据库管理：熟悉各种数据库系统，如 MySQL、Oracle、SQL Server 等，并具备对数据库进行管理、维护和优化的能力。
  * 监控工具：熟练使用各种监控工具，如 Nagios、Zabbix 等，以保证系统的稳定运行。
  * 自动化运维：熟悉各种自动化运维工具，如 Ansible、Puppet 等，以提高工作效率。
  * 编程语言：具备至少一门编程语言，如 Python、Shell、Java 等，以方便编写脚本程序。
  * 文档撰写：具备良好的文档撰写能力，以保证文档的整洁、易懂和完整。
  * 沟通协调：具备良好的沟通能力和团队合作精神，以方便与团队成员和客户进行有效沟通。
  * 问题分析：具备良好的问题分析能力

# 面试问题
## k8s方面
* 如何管理k8s集群
```
作为运维工程师，管理Kubernetes集群需要遵循一些基本原则和步骤：

安装和配置：确保集群安装并配置正确，确保所有节点处于可用状态。
集群监控：使用工具（例如Prometheus）监控集群的资源使用情况，以确保其正常运行。
生命周期管理：通过对应用、服务和容器的生命周期管理来确保集群中的所有资源运行正常。
访问控制：确保集群的安全性，限制对集群的访问和控制。
资源管理：管理集群中的资源，包括内存、磁盘空间等，以确保集群能够满足业务需求。
备份和恢复：定期备份集群数据，以便在灾难情况下进行恢复。
更新和升级：管理集群的更新和升级，以确保其保持最新状态。

这些是管理Kubernetes集群的基本步骤。如果您对Kubernetes集群管理感兴趣，可以考虑获取Kubernetes的相关认证，以确保您具备所需的知识和技能。
```

* k8s集群如何保证高可用
```
 Kubernetes 通过心跳检测机制来确定节点是否失效。如果节点失效，Kubernetes 会自动将其上的工作负载迁移到其他可用节点。
 Kubernetes 提供了Leader 选举机制，用以确保多个控制器的实例同时运行，并且只有Leader 实例提供真正的服务
```
* k8s cicd发布从开发提交代码到上线运维在每个部分起到的作用是什么我们需要关注哪些点
```
Kubernetes CICD 是指使用 Continuous Integration 和 Continuous Deployment 的方式，在 Kubernetes 集群上部署和管理应用程序。
CICD 过程通常分为以下几个部分：
开发：开发人员编写代码，并将其提交到代码仓库。
构建：构建系统从代码仓库拉取代码，并使用打包工具（如 Docker）打包应用程序。
测试：自动化测试系统对打包的应用程序进行测试，以确保代码符合质量标准。
部署：如果测试通过，应用程序将部署到 Kubernetes 集群。
运维：应用程序在生产环境中运行，运维团队负责监控和维护应用程序。
```
* k8s集群中某台机器需要关机或者维护我们如何优雅的操作
```
Kubernetes 集群中 master 节点或 node 节点关机或维护时，需要保证关机/维护操作对应用程序的影响尽可能小。以下是一些优雅的操作方法：
关闭 node 节点：使用 kubectl drain 命令可以将 node 上的工作负载平滑迁移到其他 node 上。
维护 master 节点：通常可以使用多个 master 节点，在一个 master 节点上执行维护操作时，其他 master 节点可以继续提供服务。
使用可伸缩的部署方式：使用 ReplicaSet、Deployment 等可伸缩的部署方式，可以在关机/维护期间保证应用程序的正常运行。

需要注意的是，具体的优雅关机/维护操作方式可能因 Kubernetes 集群的架构、应用程序的部署方式等因素不同而有所不同。
因此，需要根据实际情况灵活选择和使用相应的操作方法。
```
* k8s Flannel（基于隧道） 和 Calico （基于路由）
```
Flannel 首先创建了一个名为 flannel0 的网桥，而且这个网桥的一端连接 docker0 的网桥，另一端连接一个名为 flanneld 的服务进程。
Flanneld 进程并不简单，它首先上连 etcd，利用 etcd 来管理可分配的 IP 地址段资源，同时监控 etcd 中每个 Pod 的实际地址，
并在内存中建立了一个 Pod 节点路由表；然后下连 docker0 和物理网络，使用内存中的 Pod 节点路由表，将 docker0 发给它的数据包包装起来，
利用物理网络的连接将数据包投递到目标 flanneld 上，从而完成 pod 到 pod 之间的直接的地址通信。

Flannel 实现了对 Kubernetes 网络的支持，但是它引入了多个网络组件，在网络通信时需要转到 flannel0 网络接口，
再转到用户态的 flanneld 程序，到对端后还需要走这个过程的反过程，所以也会引入一些网络的时延损耗。
另外 Flannel 默认的底层通信协议是 UDP。UDP 本身是非可靠协议，虽然两端的 TCP 实现了可靠传输，
但在大流量、高并发应用场景下还需要反复调试，确保不会出现传输质量的问题。特别是对网络依赖重的应用，需要评估对业务的影响。


Calico 作为一款针对企业级数据中心的虚拟网络工具，借助 BGP、路由表和 iptables，实现了一个无需解包封包的三层网络，并且有调试简单的特点。
```
* TPS（每秒事务数） 和qps （每秒查询率）
```
区别:
TPS即每秒处理事务数，包括了
1）用户请求服务器
2）服务器自己的内部处理
3）服务器返回给用户

QPS基本类似于Tps，但是不同的是，对于一个页面的一次访问，形成一个Tps；但一次页面请求，可能产生多次对服务器的请求，服务器对这些请求，就可计入“Qps”之中。
例如：访问一个页面会请求服务器3次，一次放，产生一个“T”，产生3个“Q”

HPS：Hits per Second 每秒点击次数
是指在一秒钟的时间内用户对Web页面的链接、提交按钮等点击总和。 它一般和TPS成正比关系，是B/S系统中非常重要的性能指标之一。
```
* k8s 巨大流量时如何优雅的发布程序
```
使用部署控制器：部署控制器，如Deployment、StatefulSet、DaemonSet，可以管理Pod的生命周期和更新。
利用滚动更新：通过更新一部分Pod，再等待运行状态稳定，再更新下一部分Pod。
利用服务策略：使用Kubernetes服务策略，如滚动更新和重新导向流量，可以确保程序正常运行。
状态监控：使用监控工具，如Prometheus、Grafana等，可以查看Pod的状态，并在发生错误时立即响应。
自动回滚：通过设置Pod的生命周期钩子，可以在程序出现错误时自动回滚到上一个版本
```
* requests 和 limits 
```
requests定义了对应容器需要的最小资源量
limits定义了这个容器最大可以消耗的资源上限，防止过量消耗资源导致资源短缺甚至宕机

节点资源不足时，会触发自动驱逐，将一些低优先级的 Pod 删除掉以释放资源让节点自愈。
没有设置 request，limit 的 Pod 优先级最低，容易被驱逐；request 不等于 limit 的其次； 
request 等于 limit 的 Pod 优先级较高，不容易被驱逐。
所以如果是重要的线上应用，不希望在节点故障时被驱逐导致线上业务受影响，
就建议将 request 和 limit 设成一致。
```
* 运维需要备份k8s中哪些东西如何备份 遇到问题如何恢复
```
备份 Kubernetes 集群的重要组件包括：
1.etcd 存储库：它存储了 Kubernetes 集群的所有配置数据和状态数据，如 Pod 状态，服务映射，配置数据等。
2.配置文件：这包括 kube-apiserver、kube-controller-manager 和 kube-scheduler 的配置文件。
3.TLS 证书：这些证书用于加密 Kubernetes 集群的通信。

下面是备份这些组件的一般步骤：
备份 etcd 存储库：您可以使用 etcdctl 工具进行备份，并将存储库导出为 tar 归档文件。
备份配置文件：您可以在系统上备份配置文件，并将它们复制到备份位置。
备份证书：您可以在系统上备份证书，并将它们复制到备份位置。
在遇到问题时进行恢复，您可以从备份中还原这些组件，并使用它们恢复集群。

恢复 etcd 存储库：您可以使用 etcdctl 工具恢复存储库，并从 tar 归档文件中导入数据。
恢复配置文件：您可以从备份中还原配置文件，并将它们复制回系统。
恢复证书：您可以从备份中还原证书，并将它们复制回系统。
```
***在恢复过程中，您可能需要重新启动一些组件，以确保它们正常工作。
此外，请确保在恢复前终止集群中的所有组件，以避免在恢复数据时发生冲突。
总而言之，备份和恢复 Kubernetes 集群是一项重要任务，需要认真考虑。***

* 在 Kubernetes 集群中，高可用的保证通常通过使用多个节点和容器副本来实现。
```
1.使用多个节点：在 Kubernetes 集群中，可以通过多个节点分布容器副本，以确保在单个节点出现故障时，可以继续运行其他节点上的容器副本。
2.容器副本：Kubernetes 支持在单个集群中运行多个容器副本。这些副本可以分布在多个节点上，以确保即使单个容器出现故障，也可以通过其他副本继续提供服务。

在遇到流量峰值超过了集群承受性时，可以采取以下措施：
1.动态扩展：Kubernetes 支持通过 Horizontal Pod Autoscaler (HPA) 动态扩展容器副本数量，以应对流量的增加。
2.负载均衡：Kubernetes 支持通过使用负载均衡器，如 NGINX 或者 Istio，对流量进行分发。
3.节点扩展：如果遇到流量峰值超过了集群承受性时，可以考虑扩展集群节点数量，以增加集群的计算能力。
```
* k8s集群保证高可用的底层逻辑，集群如何知道master或者node节点机器是否正常，如果异常集群又会做什么操作
```
k8s集群中的所有节点，包括master和node，都会定期地发送心跳（heartbeat）信息到etcd数据存储中。etcd记录了每个节点的当前状态，并且可以在需要时被其他节点查询。
如果某个master或node节点因为某些原因不再能够发送心跳信息，那么其他节点将认为该节点已经挂掉。此时，etcd数据存储会将该节点的状态设置为不可用。

如果一个master节点挂掉，那么其他节点会开始选举一个新的master节点。如果一个node节点挂掉，那么k8s会将其上的容器重新分配到其他node节点上。
这样，k8s集群就能保证高可用。
```
* Kubernetes 中的有状态服务和无状态服务是两个不同的概念。
```
有状态服务（stateful service）是指有持久存储的服务，这种服务通常需要持久化存储，如数据库或消息队列等。有状态服务通常需要保留每个实例的状态，并在重新启动时保留数据。
无状态服务（stateless service）是指没有持久存储的服务，例如 Web 应用程序或网关等。无状态服务通常不需要保留状态，因此可以在不同的实例间轻松地进行水平扩展和负载平衡。

在部署时，有状态服务需要注意以下几点：
1.存储：需要为有状态服务配置持久化存储，以保留数据。
2.唯一性：每个实例的状态必须是唯一的，因此需要对实例进行命名或使用其他方法来确保它们是唯一的。
3.可靠性：因为有状态服务的数据是持久的，因此必须保证它们的可靠性。这可以通过备份和恢复等措施来实现。
无状态服务的部署相对简单，因为它们不需要考虑数据存储和实例唯一
```

## 中间件以及数据库
### mysql
* 主从同步原理
```
MySQL 的主从复制工作过程大致如下：
从库生成两个线程，一个 I/O 线程，一个 SQL 线程;
I/O 线程去请求主库的 binlog，并将得到的 binlog 日志写到 relay log(中继日志) 文件中;
主库会生成一个 log dump 线程，用来给从库 I/O 线程传 binlog;
SQL 线程会读取 relay log 文件中的日志，并解析成具体操作，来实现主从的操作一致，而最终数据一致;

MySQL 建立请求的主从的详细流程如下：
当从服务器连接主服务器时，主服务器会创建一个 log dump 线程，用于发送 binlog 的内容。在读取 binlog 的内容的操作中，会对象主节点上的 binlog 加锁，当读取完成并发送给从服务器后解锁。
当从节点上执行 start slave 命令之后，从节点会创建一个 IO 线程用来连接主节点，请求主库中更新 binlog。IO 线程接收主节点 binlog dump 进程发来的更新之后，保存到 relay-log 中。
从节点 SQL 线程负责读取 realy-log 中的内容，解析成具体的操作执行，最终保证主从数据的一致性。
```
* MySQL主从复制状态如何查看，如何判断是否同步
```
你可以使用以下命令查询这些值：
MySQL主从复制是基于日志的，查看主从是否同步，你可以查询两个值：
主服务器上的二进制日志文件的当前位置（Master_Log_File）和已经执行的日志位置（Read_Master_Log_Pos）。
从服务器上执行的二进制日志文件的位置（Relay_Master_Log_File）和已经执行的位置（Exec_Master_Log_Pos）。

如果两个位置完全一致，则说明主从已经同步。
你可以使用以下命令查询这些值：
SHOW SLAVE STATUS\G

```
* 什么情况下会造成mysql主从同步慢或者主从同步异常 怎么处理
```
1.MySQL主从同步慢或异常的原因有很多，具体取决于情况。一些常见的原因包括：
2.网络问题：网络延迟或丢包可能会导致主从同步变慢。
3.数据库负载过高：如果主服务器处理大量请求，可能会导致同步变慢。
4.binlog日志缓存不足：如果binlog缓存空间不够，需要等待binlog缓存释放以更新数据。
5.数据同步线程的限制：如果设置了最大同步线程数，这可能导致同步变慢。
6.数据冲突：如果在从服务器上执行了不与主服务器同步的更改，可能会导致数据冲突。

要解决这些问题，您可以尝试以下方法：
1.检查网络：检查网络延迟和丢包，以确保主从之间的网络连接良好。
2.调整数据库配置：优化数据库配置以减少负载。
3.扩大binlog日志缓存：增加binlog日志缓存以缓解空间不足的问题。
4.调整数据同步线程限制：增加最大同步线程数以加速同步。
5.合并数据：如果遇到数据冲突，请检查数据并进行必要的解决方案，例如手动合并数据或重新导入数据。
6.使用GTID同步：使用GTID（全局事务标识符）可以帮助您跟踪数据同步，并帮助避免数据冲突。
7.使用监控工具：使用监控工具，例如MySQL Enterprise Monitor，可以帮助您实时监控数据同步状态并快速诊断问题
```

## 网站
* 网站状态码 500 502 503 504 什么意思作为运维怎么去排查 分别怎么处理
```
500 状态码： Internal Server Error，服务器内部错误。
排查方法：检查服务器日志，确定错误的原因。
处理方法：更新代码，修复程序错误，或者重启服务器。

502 状态码：Bad Gateway，网关错误。
排查方法：检查网关的配置和连接，确定错误的原因。
处理方法：修复网关配置，重启网关或者服务器。

503 状态码：Service Unavailable，服务不可用。
排查方法：检查服务器资源是否不足，确定错误的原因。
处理方法：重启服务器，添加更多的资源，或者重新配置服务器。

504 状态码：Gateway Timeout，网关超时。
排查方法：检查网关的连接是否正常，确定错误的原因。
处理方法：重启网关或者服务器，或者修复网关的配置。

总的来说，对于这些状态码，我们需要分析错误的原因，检查相关服务器资源，并且采取相应的措施修复错误。
```


